// Language translations
const translations = {
  en: {
    hero_h1: "How much money are you losing on irrigation that doesn't work?",
    hero_h2: "We make farming possible anywhere.",
    cta_primary: "Calculate My Losses",
    hero_cta: "Increase your earnings through resilient farming",
    hero_scroll: "Scroll to explore",
    hero_image1: "High-Tech Greenhouse",
    hero_image2: "Smart Irrigation System",
    hero_image3: "Advanced Crop Technology",
    nav_about: "Solution",
    nav_features: "Who We Are",
    nav_cta: "Get Started",
    nav_contact: "Contact",
    about_title: "Who we are",
    about_copy: "At UltraCropCare¬Æ, we design, manufacture, and integrate our own robotics, software, and irrigation modules built to operate where conventional solutions fail. We've reinvented irrigation to be 10√ó more durable, portable, and cost-effective in extreme environments.",
    about_bullet1: "+40% profitability per hectare.",
    about_bullet2: "‚Üì 70% irrigation failures vs. traditional systems.",
    about_bullet3: "‚Üì 90% infrastructure required.",
    about_bullet4: "12-month return on investment.",
    about_bullet1_label: "profitability per hectare",
    about_bullet2_label: "irrigation failures vs. traditional systems",
    about_bullet3_label: "infrastructure required",
    about_bullet4_label: "return on investment",
    about_bullet4_unit: "month",
    features_title: "How can we help you?",
    features_subtitle: "Explore our solution",
    feature1_title: "Immediate Diagnosis",
    feature1_desc: "We go on-site, capture live data, and show you exactly how much you're losing today.",
    feature2_title: "Smart Irrigation without Infrastructure",
    feature2_desc: "Mobile, feather-light, resilient components ‚Äî no grid power, no connectivity needed.",
    feature3_title: "Total Control & Customized Reports",
    feature3_desc: "Clear dashboards that guide daily operations and management decisions.",
    cta_title: "We Are Looking for You",
    cta_copy: "If you keep struggling with your irrigation, you're losing money every day. Do you want to know how much you're losing by not having ARES? We'll show it to you ‚Äî no strings attached.",
    cta_subcopy: "New productions ‚Ä¢ Pilot productions ‚Ä¢ Research centres ‚Ä¢ Desert farmers ‚Ä¢ Intensive cultivation in hydroponics, greenhouses, open fields.",
    cta_button: "Book My Free Diagnosis",
    cta_highlight: "Do you want to know how much you're losing by not having ARES?",
    cta_whatsapp_title: "Do you want to know how much you're losing by not having ARES By UltraCropCare¬Æ?",
    cta_whatsapp_copy: "Book a free consultation with our team. We're ready to help you increase your profitability with resilient agriculture .",
    cta_whatsapp_button: "Start WhatsApp Chat",
    cta_email_button: "Send us an Email",
    contact_title: "Let's talk.",
    contact_name: "Patricia Arias Acosta",
    contact_phone: "üìû +56 9 9580 0313 (WhatsApp)",
    contact_email: "‚úâÔ∏è patricio.arias@ultracropcare.com",
    contact_website: "üåê www.ultracropcare.com",
    footer_copyright: "Copyright UltraCropCare¬Æ 2025",
    footer_privacy: "Privacy",
    footer_imprint: "Imprint",
    whatsapp_tooltip: "Chat now",
    language_switch: "üá™üá∏ Espa√±ol",
    meta_title: "ARES ‚Äî Agricultural Resilient Systems",
    meta_description: "10√ó more durable smart irrigation for extreme environments. Diagnose your losses in minutes and farm where others can't.",
    video_title_1: "Meet our research and development",
    video_title_2: "High density irrigation",
    video_title_3: "Technical edge (legacy video)"
  },
  es: {
    hero_h1: "¬øCu√°nto dinero est√°s perdiendo por un riego que no funciona?",
    hero_h2: "Hacemos posible la agricultura en cualquier lugar.",
    cta_primary: "Calcula tus P√©rdidas",
    hero_cta: "Aumenta tu rentabilidad con agricultura resiliente",
    hero_scroll: "Desliza para explorar",
    hero_image1: "Invernadero de Alta Tecnolog√≠a",
    hero_image2: "Sistema de Riego Inteligente",
    hero_image3: "Tecnolog√≠a Avanzada de Cultivo",
    nav_about: "Soluci√≥n",
    nav_features: "Qui√©nes somos",
    nav_cta: "Comenzar",
    nav_contact: "Contacto",
    about_title: "Qui√©nes somos",
    about_copy: "En UltraCropCare¬Æ, dise√±amos, fabricamos e integramos nuestra propia rob√≥tica, software y m√≥dulos de riego construidos para operar donde las soluciones convencionales fallan. Hemos reinventado el riego para que sea 10 veces m√°s duradero, port√°til y rentable en entornos extremos.",
    about_bullet1: "+40% de rentabilidad por hect√°rea.",
    about_bullet2: "‚Üì 70% fallos de riego vs. sistemas tradicionales.",
    about_bullet3: "‚Üì 90% infraestructura requerida.",
    about_bullet4: "Retorno de inversi√≥n en 12 meses.",
    about_bullet1_label: "de rentabilidad por hect√°rea",
    about_bullet2_label: "fallos de riego vs. sistemas tradicionales",
    about_bullet3_label: "infraestructura requerida",
    about_bullet4_label: "retorno de inversi√≥n",
    about_bullet4_unit: "meses",
    features_title: "¬øC√≥mo podemos ayudarte?",
    features_subtitle: "Explora nuestra soluci√≥n",
    feature1_title: "Diagn√≥stico Inmediato",
    feature1_desc: "Vamos al sitio, capturamos datos en vivo y te mostramos exactamente cu√°nto est√°s perdiendo hoy.",
    feature2_title: "Riego Inteligente sin Infraestructura",
    feature2_desc: "Componentes m√≥viles, ultraligeros y resistentes ‚Äî sin necesidad de energ√≠a de red ni conectividad.",
    feature3_title: "Control Total e Informes Personalizados",
    feature3_desc: "Paneles claros que gu√≠an las operaciones diarias y las decisiones de gesti√≥n.",
    cta_title: "Te estamos buscando",
    cta_copy: "Si sigues luchando con tu riego, est√°s perdiendo dinero cada d√≠a. ¬øQuieres saber cu√°nto est√°s perdiendo por no tener ARES? Te lo mostraremos ‚Äî sin compromiso.",
    cta_subcopy: "Nuevas producciones ‚Ä¢ Producciones piloto ‚Ä¢ Centros de investigaci√≥n ‚Ä¢ Agricultores del desierto ‚Ä¢ Cultivo intensivo en hidropon√≠a, invernaderos, campos abiertos.",
    cta_button: "Reserva Mi Diagn√≥stico Gratuito",
    cta_highlight: "¬øQuieres saber cu√°nto est√°s perdiendo por no tener ARES?",
    cta_whatsapp_title: "¬øQuieres saber cu√°nto est√°s perdiendo por no tener ARES?",
    cta_whatsapp_copy: "Reserva una consulta gratuita con nuestro equipo. Estamos listos para ayudarte a aumentar tu rentabilidad con soluciones agr√≠colas resilientes.",
    cta_whatsapp_button: "Iniciar Chat en WhatsApp",
    cta_email_button: "Env√≠anos un Email",
    contact_title: "Hablemos.",
    contact_name: "Patricia Arias Acosta",
    contact_phone: "üìû +56 9 9580 0313 (WhatsApp)",
    contact_email: "‚úâÔ∏è patricio.arias@ultracropcare.com",
    contact_website: "üåê www.ultracropcare.com",
    footer_copyright: "Copyright UltraCropCare¬Æ 2025",
    footer_privacy: "Privacidad",
    footer_imprint: "Aviso Legal",
    whatsapp_tooltip: "Chatear ahora",
    language_switch: "üá¨üáß English",
    meta_title: "ARES ‚Äî Agro Resiliente",
    meta_description: "Riego inteligente 10 veces m√°s duradero para entornos extremos. Diagnostica tus p√©rdidas en minutos y cultiva donde otros no pueden.",
    video_title_1: "Conoce nuestra investigaci√≥n y desarrollo",
    video_title_2: "Riego de alta densidad",
    video_title_3: "Ventaja t√©cnica (video antiguo)"
  },
  it: {
    hero_h1: "Quanti soldi stai perdendo con un'irrigazione che non funziona?",
    hero_h2: "Coltiviamo dove prima non si poteva.",
    cta_primary: "Calcola le Mie Perdite",
    hero_cta: "Aumenta la tua redditivit√† con un'agricoltura resiliente",
    hero_scroll: "Scorri per esplorare",
    hero_image1: "Serra ad Alta Tecnologia",
    hero_image2: "Sistema di Irrigazione Intelligente",
    hero_image3: "Tecnologia Avanzata delle Colture",
    nav_about: "Soluzioni",
    nav_features: "Chi siamo",
    nav_cta: "Inizia",
    nav_contact: "Contatti",
    about_title: "Chi siamo",
    about_copy: "In UltraCropCare¬Æ, progettiamo, produciamo e integriamo la nostra robotica, software e moduli di irrigazione costruiti per operare dove le soluzioni convenzionali falliscono. Abbiamo reinventato l'irrigazione per renderla 10 volte pi√π duratura, portatile ed economica in ambienti estremi.",
    about_bullet1: "+40% di redditivit√† per ettaro.",
    about_bullet2: "‚Üì 70% guasti di irrigazione rispetto ai sistemi tradizionali.",
    about_bullet3: "‚Üì 90% infrastruttura richiesta.",
    about_bullet4: "Ritorno sull'investimento in 12 mesi.",
    about_bullet1_label: "di redditivit√† per ettaro",
    about_bullet2_label: "guasti di irrigazione rispetto ai sistemi tradizionali",
    about_bullet3_label: "infrastruttura richiesta",
    about_bullet4_label: "ritorno sull'investimento",
    about_bullet4_unit: "mesi",
    features_title: "Come possiamo aiutarti?",
    features_subtitle: "Esplora la nostra soluzione",
    feature1_title: "Diagnosi Immediata",
    feature1_desc: "Andiamo sul posto, raccogliamo dati in tempo reale e ti mostriamo esattamente quanto stai perdendo oggi.",
    feature2_title: "Irrigazione Intelligente senza Infrastruttura",
    feature2_desc: "Componenti mobili, leggerissimi e resistenti ‚Äî senza bisogno di energia elettrica o connettivit√†.",
    feature3_title: "Controllo Totale e Report Personalizzati",
    feature3_desc: "Dashboard chiare che guidano le operazioni quotidiane e le decisioni di gestione.",
    cta_title: "Stiamo cercando te",
    cta_copy: "Se continui a lottare con l'irrigazione, stai perdendo denaro ogni giorno. Vuoi sapere quanto stai perdendo per non avere ARES? Te lo mostreremo ‚Äî senza impegno.",
    cta_subcopy: "Nuove produzioni ‚Ä¢ Produzioni pilota ‚Ä¢ Centri di ricerca ‚Ä¢ Agricoltori del deserto ‚Ä¢ Coltivazione intensiva in idroponica, serre, campi aperti.",
    cta_button: "Prenota la Mia Diagnosi Gratuita",
    cta_highlight: "Vuoi sapere quanto stai perdendo per non avere ARES?",
    cta_whatsapp_title: "Vuoi sapere quanto stai perdendo per non avere ARES?",
    cta_whatsapp_copy: "Prenota una consulenza gratuita con il nostro team. Siamo pronti ad aiutarti ad aumentare la tua redditivit√† con soluzioni agricole resilienti.",
    cta_whatsapp_button: "Inizia Chat WhatsApp",
    cta_email_button: "Inviaci una Email",
    contact_title: "Parliamone.",
    contact_name: "Patricia Arias Acosta",
    contact_phone: "üìû +56 9 9580 0313 (WhatsApp)",
    contact_email: "‚úâÔ∏è patricio.arias@ultracropcare.com",
    contact_website: "üåê www.ultracropcare.com",
    footer_copyright: "Copyright UltraCropCare¬Æ 2025",
    footer_privacy: "Privacy",
    footer_imprint: "Note Legali",
    whatsapp_tooltip: "Chatta ora",
    language_switch: "üá¨üáß English",
    meta_title: "ARES ‚Äî Sistemi Agricoli Resilienti di UltraCropCare¬Æ",
    meta_description: "Irrigazione intelligente 10 volte pi√π duratura per ambienti estremi. Diagnostica le tue perdite in minuti e coltiva dove altri non possono.",
    video_title_1: "Incontra la nostra ricerca e sviluppo",
    video_title_2: "Irrigazione ad alta densit√†",
    video_title_3: "Vantaggio tecnico (video precedente)"
  }
};

// DOM Elements
const languageButton = document.getElementById('main-language-button');
const languageDropdown = document.getElementById('main-language-dropdown');
const mobileLanguageButton = document.getElementById('mobile-language-button');
const mobileLanguageDropdown = document.getElementById('mobile-language-dropdown');
const navbar = document.querySelector('.navbar');
const mobileMenuButton = document.querySelector('.mobile-menu-button');
const mobileMenu = document.querySelector('.mobile-menu');
const sections = document.querySelectorAll('section');

// Current language
let currentLanguage = 'en';

// Detector de dispositivo m√≥vil
const isMobile = () => window.innerWidth < 768;

// Toggle mobile menu
if (mobileMenuButton && mobileMenu) {
  mobileMenuButton.addEventListener('click', function() {
    mobileMenuButton.classList.toggle('active');
    mobileMenu.classList.toggle('active');
    
    // A√±adir/remover clase menu-open al html y body
    if (mobileMenu.classList.contains('active')) {
      document.documentElement.classList.add('menu-open');
      document.body.classList.add('menu-open');
    } else {
      document.documentElement.classList.remove('menu-open');
      document.body.classList.remove('menu-open');
    }
  });
}

// Cerrar men√∫ m√≥vil al hacer clic en un enlace
document.querySelectorAll('.mobile-link').forEach(link => {
  link.addEventListener('click', function() {
    if (mobileMenuButton && mobileMenu) {
      mobileMenuButton.classList.remove('active');
      mobileMenu.classList.remove('active');
      document.documentElement.classList.remove('menu-open');
      document.body.classList.remove('menu-open');
    }
  });
});

// Function to toggle language dropdown
function toggleLanguageDropdown(dropdownElement) {
  if (dropdownElement) {
    dropdownElement.classList.toggle('show');
  }
}

// Function to change language
function setLanguage(lang) {
  if (!translations[lang]) return;
  
  currentLanguage = lang;
  
  // Guardar preferencia de idioma en localStorage
  localStorage.setItem('ares_language', lang);
  
  // Update language buttons
  if (languageButton) {
    if (lang === 'en') {
      languageButton.innerHTML = `<span class="flag-icon"><img src="images/usa.png" alt="English" class="flag-img"></span> English`;
    } else if (lang === 'es') {
      languageButton.innerHTML = `<span class="flag-icon"><img src="images/es.png" alt="Espa√±ol" class="flag-img"></span> Espa√±ol`;
    } else if (lang === 'it') {
      languageButton.innerHTML = `<span class="flag-icon"><img src="images/it.png" alt="Italiano" class="flag-img"></span> Italiano`;
    }
  }
  
  if (mobileLanguageButton) {
    if (lang === 'en') {
      mobileLanguageButton.innerHTML = `<span class="flag-icon"><img src="images/usa.png" alt="English" class="flag-img"></span> English`;
    } else if (lang === 'es') {
      mobileLanguageButton.innerHTML = `<span class="flag-icon"><img src="images/es.png" alt="Espa√±ol" class="flag-img"></span> Espa√±ol`;
    } else if (lang === 'it') {
      mobileLanguageButton.innerHTML = `<span class="flag-icon"><img src="images/it.png" alt="Italiano" class="flag-img"></span> Italiano`;
    }
  }
  
  // Update page title and meta description
  document.title = translations[currentLanguage].meta_title;
  const metaDescription = document.querySelector('meta[name="description"]');
  if (metaDescription) {
    metaDescription.setAttribute('content', translations[currentLanguage].meta_description);
  }
  
  // Update all text elements with data-i18n attribute
  document.querySelectorAll('[data-i18n]').forEach(element => {
    const key = element.getAttribute('data-i18n');
    if (translations[currentLanguage][key]) {
      element.textContent = translations[currentLanguage][key];
    }
  });
  
  // Update specific elements
  const heroTitle = document.querySelector('.hero-title');
  if (heroTitle) {
    heroTitle.textContent = translations[currentLanguage].hero_h1;
  }
  
  // Verificar si estos elementos existen antes de actualizarlos
  const heroSubtitle = document.querySelector('.hero-subtitle');
  if (heroSubtitle) {
    heroSubtitle.textContent = translations[currentLanguage].hero_h2;
  }
  
  const scrollLink = document.querySelector('.scroll-link span');
  if (scrollLink) {
    scrollLink.textContent = translations[currentLanguage].hero_cta;
  }
  
  const scrollText = document.querySelector('.scroll-text');
  if (scrollText) {
    scrollText.textContent = translations[currentLanguage].hero_scroll;
  }
  
  // Update image labels if they exist
  const imageLabels = document.querySelectorAll('.image-label');
  if (imageLabels.length > 0) {
    if (imageLabels[0]) imageLabels[0].textContent = translations[currentLanguage].hero_image1;
    if (imageLabels[1]) imageLabels[1].textContent = translations[currentLanguage].hero_image2;
    if (imageLabels[2]) imageLabels[2].textContent = translations[currentLanguage].hero_image3;
  }
  
  // Update navigation links if they exist
  const navLinks = document.querySelectorAll('.nav-link');
  if (navLinks.length > 0) {
    if (navLinks[0]) navLinks[0].textContent = translations[currentLanguage].nav_features;
    if (navLinks[1]) navLinks[1].textContent = translations[currentLanguage].nav_about;
    if (navLinks[2]) navLinks[2].textContent = translations[currentLanguage].nav_cta;
  }
  
  // Update mobile navigation links if they exist
  const mobileLinks = document.querySelectorAll('.mobile-link');
  if (mobileLinks.length > 0) {
    if (mobileLinks[0]) mobileLinks[0].textContent = translations[currentLanguage].nav_features;
    if (mobileLinks[1]) mobileLinks[1].textContent = translations[currentLanguage].nav_about;
    if (mobileLinks[2]) mobileLinks[2].textContent = translations[currentLanguage].nav_cta;
  }
  
  // About section - verificar si los elementos existen antes de actualizarlos
  const aboutTitle = document.querySelector('#about .section-title');
  if (aboutTitle) {
    aboutTitle.textContent = translations[currentLanguage].about_title;
  }
  
  const aboutDescription = document.querySelector('.about-description');
  if (aboutDescription) {
    aboutDescription.textContent = translations[currentLanguage].about_copy;
  }
  
  // Features section
  const featuresTitle = document.querySelector('#features .section-title');
  if (featuresTitle) {
    featuresTitle.textContent = translations[currentLanguage].features_title;
  }
  
  const featuresSubtitle = document.querySelector('.section-subtitle');
  if (featuresSubtitle) {
    featuresSubtitle.textContent = translations[currentLanguage].features_subtitle;
  }
  
  const featuresTitles = document.querySelectorAll('.feature-title');
  const featuresDescriptions = document.querySelectorAll('.feature-description');
  
  if (featuresTitles.length > 0 && featuresDescriptions.length > 0) {
    if (featuresTitles[0]) featuresTitles[0].textContent = translations[currentLanguage].feature1_title;
    if (featuresDescriptions[0]) featuresDescriptions[0].textContent = translations[currentLanguage].feature1_desc;
    if (featuresTitles[1]) featuresTitles[1].textContent = translations[currentLanguage].feature2_title;
    if (featuresDescriptions[1]) featuresDescriptions[1].textContent = translations[currentLanguage].feature2_desc;
    if (featuresTitles[2]) featuresTitles[2].textContent = translations[currentLanguage].feature3_title;
    if (featuresDescriptions[2]) featuresDescriptions[2].textContent = translations[currentLanguage].feature3_desc;
  }
  
  // CTA section
  const ctaTitle = document.querySelector('#cta .section-title');
  if (ctaTitle) {
    ctaTitle.textContent = translations[currentLanguage].cta_title;
  }
  
  const ctaText = document.querySelector('.cta-text');
  if (ctaText) {
    ctaText.textContent = translations[currentLanguage].cta_copy;
  }
  
  const ctaHighlight = document.querySelector('.cta-highlight');
  if (ctaHighlight) {
    ctaHighlight.textContent = translations[currentLanguage].cta_highlight;
  }
  
  const ctaSubcopy = document.querySelector('.cta-subcopy');
  if (ctaSubcopy) {
    ctaSubcopy.textContent = translations[currentLanguage].cta_subcopy;
  }
  
  // Verificar si existe el elemento antes de intentar actualizarlo
  const ctaButtonLarge = document.querySelector('.cta-button-large');
  if (ctaButtonLarge) {
    ctaButtonLarge.textContent = translations[currentLanguage].cta_button;
  }
  
  const ctaWhatsappTitle = document.querySelector('.cta-whatsapp-title');
  if (ctaWhatsappTitle) {
    ctaWhatsappTitle.textContent = translations[currentLanguage].cta_whatsapp_title;
  }
  
  const ctaWhatsappCopy = document.querySelector('.cta-whatsapp-copy');
  if (ctaWhatsappCopy) {
    ctaWhatsappCopy.textContent = translations[currentLanguage].cta_whatsapp_copy;
  }
  
  const ctaWhatsappButton = document.querySelector('.cta-whatsapp-button');
  if (ctaWhatsappButton) {
    ctaWhatsappButton.textContent = translations[currentLanguage].cta_whatsapp_button;
  }
  
  // Footer
  const copyright = document.querySelector('.copyright');
  if (copyright) {
    copyright.textContent = translations[currentLanguage].footer_copyright;
  }
  
  // Verificar si existen los elementos de enlaces de footer antes de actualizarlos
  const footerLinks = document.querySelectorAll('.footer-link');
  if (footerLinks.length > 0) {
    if (footerLinks[0]) footerLinks[0].textContent = translations[currentLanguage].footer_privacy;
    if (footerLinks.length > 1 && footerLinks[1]) footerLinks[1].textContent = translations[currentLanguage].footer_imprint;
  }
  
  // WhatsApp tooltip
  const tooltip = document.querySelector('.tooltip');
  if (tooltip) {
    tooltip.textContent = translations[currentLanguage].whatsapp_tooltip;
  }
  
  // HTML lang attribute
  document.documentElement.setAttribute('lang', currentLanguage);
  
  // Close the dropdowns after selection
  if (languageDropdown) {
    languageDropdown.classList.remove('show');
  }
  
  // Set language for WhatsApp URL dynamic text in different languages
  const whatsappLinks = document.querySelectorAll('a[href*="wa.me"]');
  whatsappLinks.forEach(link => {
    let baseUrl = "https://wa.me/56995800313?text=";
    let messageText = "";
    
    if (currentLanguage === 'en') {
      messageText = "Hi UltraCropCare team, I'd like to learn about ARES";
    } else if (currentLanguage === 'es') {
      messageText = "Hola equipo UltraCropCare, me gustar√≠a conocer m√°s sobre ARES";
    } else if (currentLanguage === 'it') {
      messageText = "Ciao team UltraCropCare, vorrei saperne di pi√π su ARES";
    }
    
    link.setAttribute('href', baseUrl + encodeURIComponent(messageText));
  });
}

// Event Listeners
// Language dropdown items will be attached in the main load event

// Smooth scrolling for anchor links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
  anchor.addEventListener('click', function(e) {
    e.preventDefault();
    
    const targetId = this.getAttribute('href');
    const targetElement = document.querySelector(targetId);
    
    if (targetElement) {
      // Offset diferente para m√≥vil y desktop
      const offset = isMobile() ? 60 : 70;
      
      window.scrollTo({
        top: targetElement.offsetTop - offset,
        behavior: 'smooth'
      });
    }
  });
});

// Window scroll event
window.addEventListener('scroll', function() {
  // No aplicar efectos de cambio de navbar en m√≥viles
  if (isMobile()) return;
  
  // Obtener referencias a todas las secciones
  const heroSection = document.getElementById('hero');
  const featuresSection = document.getElementById('features');
  const ctaSection = document.getElementById('cta');
  const aboutSection = document.getElementById('about');
  
  // Variable para rastrear si cambi√≥ la clase de la navbar
  let navbarClassChanged = false;
  const currentNavbarClass = navbar.classList.contains('navbar-hero') ? 'navbar-hero' : 
                           navbar.classList.contains('navbar-features') ? 'navbar-features' :
                           navbar.classList.contains('navbar-cta') ? 'navbar-cta' :
                           navbar.classList.contains('navbar-about') ? 'navbar-about' : '';
  
  // Eliminar todas las clases de navbar espec√≠ficas
  navbar.classList.remove('navbar-hero', 'navbar-features', 'navbar-cta', 'navbar-about');
  
  // Obtener la posici√≥n de cada secci√≥n
  if (heroSection) {
    const heroRect = heroSection.getBoundingClientRect();
    const heroVisible = heroRect.top <= 70 && heroRect.bottom >= 70;
    
    if (heroVisible) {
      navbar.classList.add('navbar-hero');
      navbarClassChanged = (currentNavbarClass !== 'navbar-hero');
      return;
    }
  }
  
  if (featuresSection) {
    const featuresRect = featuresSection.getBoundingClientRect();
    const featuresVisible = featuresRect.top <= 70 && featuresRect.bottom >= 70;
    
    if (featuresVisible) {
      navbar.classList.add('navbar-features');
      navbarClassChanged = (currentNavbarClass !== 'navbar-features');
      return;
    }
  }
  
  if (ctaSection) {
    const ctaRect = ctaSection.getBoundingClientRect();
    const ctaVisible = ctaRect.top <= 70 && ctaRect.bottom >= 70;
    
    if (ctaVisible) {
      navbar.classList.add('navbar-cta');
      navbarClassChanged = (currentNavbarClass !== 'navbar-cta');
      return;
    }
  }
  
  if (aboutSection) {
    const aboutRect = aboutSection.getBoundingClientRect();
    const aboutVisible = aboutRect.top <= 70 && aboutRect.bottom >= 70;
    
    if (aboutVisible) {
      navbar.classList.add('navbar-about');
      navbarClassChanged = (currentNavbarClass !== 'navbar-about');
      return;
    }
  }
  
  // Si cambi√≥ la clase de la navbar, aplicar efectos
  if (navbarClassChanged) {
    applyNavbarEffects();
  }
});

// Funci√≥n para aplicar efectos a la navbar
function applyNavbarEffects() {
  // Eliminar solo la clase de parpadeo previa, mantener bloom si existe
  navbar.classList.remove('navbar-flicker');
  
  // Aplicar efecto de parpadeo
  navbar.classList.add('navbar-flicker');
  
  // Aplicar efecto bloom despu√©s del parpadeo (si no existe ya)
  setTimeout(() => {
    navbar.classList.remove('navbar-flicker');
    navbar.classList.add('navbar-bloom');
  }, 1500);
}

// Add fade-up animation to sections
function checkScroll() {
  sections.forEach(section => {
    const sectionTop = section.getBoundingClientRect().top;
    const windowHeight = window.innerHeight;
    
    if (sectionTop < windowHeight * 0.75) {
      section.classList.add('fade-up');
    }
  });
}

// Funci√≥n para desactivar/activar scroll-snap seg√∫n el tama√±o de pantalla
function toggleScrollSnap() {
  const htmlElement = document.documentElement;
  
  if (isMobile()) {
    // Desactivar scroll-snap en m√≥viles
    htmlElement.style.scrollSnapType = 'none';
    htmlElement.style.height = 'auto';
    htmlElement.style.overflowY = 'auto';
    
    // Desactivar scroll-snap en secciones
    sections.forEach(section => {
      section.style.scrollSnapAlign = 'none';
      section.style.scrollSnapStop = 'normal';
    });
  } else {
    // Restaurar scroll-snap en desktop
    htmlElement.style.scrollSnapType = '';
    htmlElement.style.height = '';
    htmlElement.style.overflowY = '';
    
    // Restaurar scroll-snap en secciones
    sections.forEach(section => {
      section.style.scrollSnapAlign = '';
      section.style.scrollSnapStop = '';
    });
  }
}

// Initial check on page load
window.addEventListener('load', () => {
  // Iniciar siempre con ingl√©s como idioma predeterminado
  currentLanguage = 'en';
  document.documentElement.setAttribute('lang', 'en');
  
  // Aplicar traducciones iniciales
  setLanguage('en');
  
  // Desactivar/activar scroll-snap seg√∫n el dispositivo
  toggleScrollSnap();
  
  // Aplicar la clase navbar-hero inicialmente si estamos en la parte superior
  if (window.scrollY < 100) {
    navbar.classList.add('navbar-hero');
    // Aplicar efectos iniciales a la navbar
    setTimeout(() => {
      applyNavbarEffects();
    }, 500);
  } else {
    // Si no estamos en la parte superior, verificar qu√© secci√≥n est√° visible
    const heroSection = document.getElementById('hero');
    const featuresSection = document.getElementById('features');
    const ctaSection = document.getElementById('cta');
    const aboutSection = document.getElementById('about');
    
    // Obtener la posici√≥n de cada secci√≥n
    if (heroSection && heroSection.getBoundingClientRect().top <= 70 && heroSection.getBoundingClientRect().bottom >= 70) {
      navbar.classList.add('navbar-hero');
    } else if (featuresSection && featuresSection.getBoundingClientRect().top <= 70 && featuresSection.getBoundingClientRect().bottom >= 70) {
      navbar.classList.add('navbar-features');
    } else if (ctaSection && ctaSection.getBoundingClientRect().top <= 70 && ctaSection.getBoundingClientRect().bottom >= 70) {
      navbar.classList.add('navbar-cta');
    } else if (aboutSection && aboutSection.getBoundingClientRect().top <= 70 && aboutSection.getBoundingClientRect().bottom >= 70) {
      navbar.classList.add('navbar-about');
    }
    
    // Aplicar efectos iniciales a la navbar
    setTimeout(() => {
      applyNavbarEffects();
    }, 500);
  }
  
  checkScroll();
  
  // Set language for WhatsApp URL dynamic text in different languages
  updateWhatsAppLinks();
  
  // Set up language dropdown click handlers
  document.querySelectorAll('#main-language-dropdown .lang-option').forEach(option => {
    option.addEventListener('click', function() {
      const lang = this.getAttribute('data-lang');
      setLanguage(lang);
    });
  });
  
  // Set up mobile language dropdown click handlers
  document.querySelectorAll('#mobile-language-dropdown .lang-option').forEach(option => {
    option.addEventListener('click', function() {
      const lang = this.getAttribute('data-lang');
      setLanguage(lang);
      mobileMenu.classList.remove('active'); // Cerrar el men√∫ m√≥vil al seleccionar idioma
    });
  });
  
  // Language button click handler
  if (languageButton) {
    languageButton.addEventListener('click', () => toggleLanguageDropdown(languageDropdown));
  }
  
  // Mobile language button click handler
  if (mobileLanguageButton) {
    mobileLanguageButton.addEventListener('click', () => toggleLanguageDropdown(mobileLanguageDropdown));
  }
  
  // Close dropdown when clicking outside
  document.addEventListener('click', function(event) {
    if (languageDropdown && languageButton) {
      const isClickInside = languageButton.contains(event.target) || 
                           languageDropdown.contains(event.target);
      
      if (!isClickInside && languageDropdown.classList.contains('show')) {
        languageDropdown.classList.remove('show');
      }
    }
    
    if (mobileLanguageDropdown && mobileLanguageButton) {
      const isClickInside = mobileLanguageButton.contains(event.target) || 
                           mobileLanguageDropdown.contains(event.target);
      
      if (!isClickInside && mobileLanguageDropdown.classList.contains('show')) {
        mobileLanguageDropdown.classList.remove('show');
      }
    }
  });
});

// Funci√≥n auxiliar para actualizar los enlaces de WhatsApp
function updateWhatsAppLinks() {
  const whatsappLinks = document.querySelectorAll('a[href*="wa.me"]');
  whatsappLinks.forEach(link => {
    let baseUrl = "https://wa.me/56995800313?text=";
    let messageText = "";
    
    if (currentLanguage === 'en') {
      messageText = "Hi UltraCropCare team, I'd like to learn about ARES";
    } else if (currentLanguage === 'es') {
      messageText = "Hola equipo UltraCropCare, me gustar√≠a conocer m√°s sobre ARES";
    } else if (currentLanguage === 'it') {
      messageText = "Ciao team UltraCropCare, vorrei saperne di pi√π su ARES";
    }
    
    link.setAttribute('href', baseUrl + encodeURIComponent(messageText));
  });
}

// Slider functionality
document.addEventListener('DOMContentLoaded', function() {
  const slides = document.querySelectorAll('.slide');
  const dots = document.querySelectorAll('.dot');
  const sliderContainer = document.querySelector('.slider-container');
  const zoomModal = document.getElementById('zoomModal');
  const zoomedImage = document.getElementById('zoomedImage');
  const closeZoom = document.getElementById('closeZoom');
  
  let currentSlide = 0;
  const totalSlides = slides.length;
  
  // Initialize translations for new slides
  updateSlideLabels();
  
  // Function to show a specific slide
  function showSlide(index) {
    // Hide all slides
    slides.forEach(slide => {
      slide.classList.remove('active');
    });
    
    // Remove active class from all dots
    dots.forEach(dot => {
      dot.classList.remove('active');
    });
    
    // Show the target slide
    slides[index].classList.add('active');
    
    // Add active class to current dot
    dots[index].classList.add('active');
    
    currentSlide = index;
  }
  
  // Event listeners for dots
  dots.forEach((dot, index) => {
    dot.addEventListener('click', () => {
      showSlide(index);
    });
  });
  
  // Autoplay functionality
  let slideInterval = setInterval(() => {
    currentSlide = (currentSlide + 1) % totalSlides;
    showSlide(currentSlide);
  }, 5000);
  
  // Pause autoplay on hover
  if (sliderContainer) {
    sliderContainer.addEventListener('mouseenter', () => {
      clearInterval(slideInterval);
    });
    
    sliderContainer.addEventListener('mouseleave', () => {
      slideInterval = setInterval(() => {
        currentSlide = (currentSlide + 1) % totalSlides;
        showSlide(currentSlide);
      }, 5000);
    });
  }
  
  // Zoom functionality
  slides.forEach(slide => {
    const slideImage = slide.querySelector('.slide-image');
    if (slideImage) {
      slideImage.addEventListener('click', () => {
        zoomedImage.src = slideImage.src;
        zoomedImage.alt = slideImage.alt;
        zoomModal.classList.add('active');
        document.body.style.overflow = 'hidden';
      });
    }
  });
  
  // Close zoom modal
  if (closeZoom) {
    closeZoom.addEventListener('click', () => {
      zoomModal.classList.remove('active');
      document.body.style.overflow = 'auto';
    });
  }
  
  // Close on click outside
  zoomModal.addEventListener('click', (e) => {
    if (e.target === zoomModal) {
      zoomModal.classList.remove('active');
      document.body.style.overflow = 'auto';
    }
  });
  
  // Update slide labels when language changes
  function updateSlideLabels() {
    const labels = {
      en: ["High-Tech Greenhouse", "Smart Irrigation System", "Advanced Crop Technology"],
      es: ["Invernadero de Alta Tecnolog√≠a", "Sistema de Riego Inteligente", "Tecnolog√≠a Avanzada de Cultivo"],
      it: ["Serra ad Alta Tecnologia", "Sistema di Irrigazione Intelligente", "Tecnologia Avanzata delle Colture"]
    };
    
    // Add translations if they don't exist
    if (!translations.en.hero_image3) {
      translations.en.hero_image3 = "Advanced Crop Technology";
      translations.es.hero_image3 = "Tecnolog√≠a Avanzada de Cultivo";
      translations.it.hero_image3 = "Tecnologia Avanzata delle Colture";
    }
    
    // Update labels based on current language
    const slideLabels = document.querySelectorAll('.image-label');
    if (slideLabels.length >= 3) {
      slideLabels[0].textContent = translations[currentLanguage].hero_image1;
      slideLabels[1].textContent = translations[currentLanguage].hero_image2;
      slideLabels[2].textContent = translations[currentLanguage].hero_image3;
    }
  }
  
  // Update slide labels when language changes
  const oldSetLanguage = setLanguage;
  setLanguage = function(lang) {
    oldSetLanguage(lang);
    updateSlideLabels();
  };
});

// Video Carousel functionality
document.addEventListener('DOMContentLoaded', function() {
  // Add translations for video titles
  translations.en.video_title_1 = "Meet our research and development";
  translations.en.video_title_2 = "High density irrigation";
  translations.en.video_title_3 = "Technical edge (legacy video)";
  
  translations.es.video_title_1 = "Conoce nuestra investigaci√≥n y desarrollo";
  translations.es.video_title_2 = "Riego de alta densidad";
  translations.es.video_title_3 = "Ventaja t√©cnica (video antiguo)";
  
  translations.it.video_title_1 = "Incontra la nostra ricerca e sviluppo";
  translations.it.video_title_2 = "Irrigazione ad alta densit√†";
  translations.it.video_title_3 = "Vantaggio tecnico (video precedente)";

  const videoSlides = document.querySelectorAll('.video-slide');
  const videoDots = document.querySelectorAll('.video-dot');
  const videoPrevBtn = document.querySelector('.video-prev-btn');
  const videoNextBtn = document.querySelector('.video-next-btn');
  
  let currentVideoSlide = 0;
  const totalVideoSlides = videoSlides.length;
  
  // Function to update video title translations
  function updateVideoTitles() {
    const videoTitles = document.querySelectorAll('.video-title');
    if (videoTitles.length >= 3) {
      videoTitles[0].textContent = translations[currentLanguage].video_title_1;
      videoTitles[1].textContent = translations[currentLanguage].video_title_2;
      videoTitles[2].textContent = translations[currentLanguage].video_title_3;
    }
  }
  
  // Initialize translations for video titles
  updateVideoTitles();
  
  // Function to show a specific video slide
  function showVideoSlide(index) {
    // Pause all videos when switching slides
    videoSlides.forEach(slide => {
      const iframe = slide.querySelector('iframe');
      if (iframe) {
        // This will stop the video from playing
        const src = iframe.src;
        iframe.src = src;
      }
      slide.classList.remove('active');
    });
    
    // Remove active class from all dots
    videoDots.forEach(dot => {
      dot.classList.remove('active');
    });
    
    // Show the target slide
    videoSlides[index].classList.add('active');
    
    // Add active class to current dot
    videoDots[index].classList.add('active');
    
    currentVideoSlide = index;
  }
  
  // Event listeners for navigation buttons
  if (videoPrevBtn) {
    videoPrevBtn.addEventListener('click', () => {
      currentVideoSlide = (currentVideoSlide - 1 + totalVideoSlides) % totalVideoSlides;
      showVideoSlide(currentVideoSlide);
    });
  }
  
  if (videoNextBtn) {
    videoNextBtn.addEventListener('click', () => {
      currentVideoSlide = (currentVideoSlide + 1) % totalVideoSlides;
      showVideoSlide(currentVideoSlide);
    });
  }
  
  // Event listeners for dots
  videoDots.forEach((dot, index) => {
    dot.addEventListener('click', () => {
      showVideoSlide(index);
    });
  });
  
  // Update video titles when language changes
  const previousSetLanguage = setLanguage;
  setLanguage = function(lang) {
    previousSetLanguage(lang);
    updateVideoTitles();
  };
});

// Video navigation hover effect
document.addEventListener('DOMContentLoaded', function() {
  const videoShowcase = document.querySelector('.video-showcase');
  const videoNavigation = document.querySelector('.video-navigation');
  
  if (videoShowcase && videoNavigation) {
    videoShowcase.addEventListener('mouseenter', function() {
      videoNavigation.style.opacity = '1';
    });
    
    videoShowcase.addEventListener('mouseleave', function() {
      videoNavigation.style.opacity = '0';
    });
  }
});

// Funci√≥n mejorada para cargar la fuente Bruce Forever
document.addEventListener('DOMContentLoaded', function() {
  // Usar WebFontLoader para cargar la fuente de manera confiable
  WebFont.load({
    custom: {
      families: ['Bruce Forever'],
      urls: ['styles.css']
    },
    timeout: 2000, // Tiempo m√°ximo de espera: 2 segundos
    active: function() {
      console.log('La fuente Bruce Forever se ha cargado correctamente.');
    },
    inactive: function() {
      console.warn('La fuente Bruce Forever no se pudo cargar. Usando fuente alternativa.');
      // Agregar una clase al logo para utilizar una fuente alternativa
      const logoText = document.querySelector('.logo-text');
      if (logoText) {
        logoText.classList.add('fallback-font');
      }
      
      // Intentar cargar la fuente desde un CDN como respaldo
      const fontCDN = document.createElement('link');
      fontCDN.rel = 'stylesheet';
      fontCDN.href = 'https://fontcdn.org/bruce-forever/bruce-forever.css'; // URL de ejemplo (reemplazar por el CDN real)
      document.head.appendChild(fontCDN);
    }
  });
});

// Aplicar cambios cuando cambia el tama√±o de la ventana
window.addEventListener('resize', function() {
  // Desactivar/activar scroll-snap seg√∫n el tama√±o actual
  toggleScrollSnap();
  
  // Gestionar men√∫ m√≥vil en cambio de tama√±o
  if (!isMobile() && mobileMenu && mobileMenu.classList.contains('active')) {
    mobileMenuButton.classList.remove('active');
    mobileMenu.classList.remove('active');
    document.documentElement.classList.remove('menu-open');
    document.body.classList.remove('menu-open');
  }
});
